#  complete data case

```{r}
library(ClusterR)
library(caret)
library(ClustImpute)
IBS <- dietary_survey_IBS
IBS$class <- factor(dietary_survey_IBS$class,labels =c(2,1)) %>% as.numeric()
```

## 10% missing
### partial km
```{r}
IBS10 <- as.data.frame(lapply(IBS, function(cc) cc[ sample(c(TRUE, NA), prob = c(0.9, 0.1), size = length(cc), replace = TRUE) ]))
set.seed(34)
trainIndex <- createDataPartition(IBS$class, p = .7,
                                  list = FALSE,
                                  times = 1)
Train_IBS10 <- IBS10[ trainIndex,]
Valid_IBS10 <- IBS10[-trainIndex,]
Train_IBS <- IBS[ trainIndex,]
Valid_IBS <- IBS[-trainIndex,]
initC <- apply(Train_IBS10,2, function(x){x[sample(complete.cases(x) %>% which(),2)]})
initc <- as.data.frame(initC)[,1:42] %>% unlist() %>%as.numeric()

partial_model <- Partial_km(Train_IBS10[,-43],2,initc,10)
#manually change cluster sets
IBS10_fitted <- factor(partial_model$fitted_value,labels = c(2,1))
test_accuracy(Train_IBS10[,43],IBS10_fitted)
```

### ClustImpute

```{r}
imput_model10 <- ClustImpute(Train_IBS10[,-43],nr_cluster=2)
#imput_fitted <- factor(imput_model$clusters,labels = c(0,1))
test_accuracy(Train_IBS10[,43],imput_model10$clusters)
```

# test 
```{r}
partial_test10 <- fitted.test(Valid_IBS10[,-43],2,partial_model$fitted_Centroid)
test_cluster10 <- factor(partial_test10$fitted_values,labels = c(2,1))
test_accuracy(Valid_IBS[,43],test_cluster10)
test_accuracy(Valid_IBS10[,43],test_cluster10)
```
test accuracy of partial_km is 0.8083333

```{r}
impute_test10 <- fitted.test(Valid_IBS10[,-43],2,imput_model$centroids[,-43])
impute_cluster10 <- impute_test10$fitted_values
test_accuracy(Valid_IBS[,43],impute_cluster10)
test_accuracy(Valid_IBS10[,43],impute_cluster10)
```
test_accuracy of ClustImpute is 0.8166667

## 20% missing
```{r}

IBS20 <- as.data.frame(lapply(IBS, function(cc) cc[ sample(c(TRUE, NA), prob = c(0.8, 0.2), size = length(cc), replace = TRUE) ]))

Train_IBS20 <- IBS20[ trainIndex,]
Valid_IBS20 <- IBS20[-trainIndex,]
initC <- apply(Train_IBS20,2, function(x){x[sample(complete.cases(x) %>% which(),2)]})
initc <- as.data.frame(initC)[,1:42] %>% unlist() %>%as.numeric()

partial_model <- Partial_km(Train_IBS20[,-43],2,initc,10)
#manually change cluster sets
IBS20_fitted <- factor(partial_model$fitted_value,labels = c(2,1))
test_accuracy(Train_IBS20[,43],IBS20_fitted)

```
train accuracy of partial_km is 0.6892857
```{r}

imput_model <- ClustImpute(Train_IBS20[,-43],nr_cluster=2)
#imput_fitted <- factor(imput_model$clusters,labels = c(0,1))
test_accuracy(Train_IBS20[,43],imput_model$clusters)
```
train accuracy of ClustImpute is 0.6964286

# test 
```{r}
partial_test20 <- fitted.test(Valid_IBS20[,-43],2,partial_model$fitted_Centroid)
test_cluster20 <- factor(partial_test20$fitted_values,labels = c(2,1))
test_accuracy(Valid_IBS[,43],test_cluster20)
test_accuracy(Valid_IBS20[,43],test_cluster20)
```
test accuracy of partial_km is 0.6583333

```{r}
impute_test20 <- fitted.test(Valid_IBS20[,-43],2,imput_model$centroids[,-43])
impute_cluster20 <- impute_test20$fitted_values
test_accuracy(Valid_IBS[,43],impute_cluster20)
test_accuracy(Valid_IBS20[,43],impute_cluster20)
```
test_accuracy of ClustImpute is 0.6583333


#30% missing
```{r}
set.seed(34)
IBS30 <- as.data.frame(lapply(IBS, function(cc) cc[ sample(c(TRUE, NA), prob = c(0.7, 0.3), size = length(cc), replace = TRUE) ]))
Train_IBS30 <- IBS30[ trainIndex,]
Valid_IBS30 <- IBS30[-trainIndex,]
initC <- apply(Train_IBS30,2, function(x){x[sample(complete.cases(x) %>% which(),2)]})
initc <- as.data.frame(initC)[,1:42] %>% unlist() %>%as.numeric()

partial_model30 <- Partial_km(Train_IBS30[,-43],2,initc,10)
IBS30_fitted <- factor(partial_model30$fitted_value,labels = c(2,1))
test_accuracy(Train_IBS30[,43],IBS30_fitted)
```
train accuracy of partial_km is 0.675

```{r}
imput_model30 <- ClustImpute(Train_IBS30[,-43],nr_cluster=2)
imput_fitted30 <- factor(imput_model30$clusters,labels = c(2,1))
test_accuracy(Train_IBS30[,43],imput_fitted30)
```
train accuracy of ClustImpute is 0.575

#test
```{r}
partial_test30 <- fitted.test(Valid_IBS30[,-43],2,partial_model30$fitted_Centroid)
test_accuracy(Valid_IBS[,43],factor(partial_test30$fitted_values,labels = c(2,1)))
test_accuracy(Valid_IBS30[,43],factor(partial_test30$fitted_values,labels = c(2,1)))
```
test accuracy of partial_km is 0.5666667

```{r}
impute_test30 <- fitted.test(Valid_IBS30[,-43],2,imput_model30$centroids[,-43])
test_accuracy(Valid_IBS[,43],factor(impute_test30$fitted_values,labels = c(2,1)))
test_accuracy(Valid_IBS30[,43],factor(impute_test30$fitted_values,labels = c(2,1)))
```
test accuracy of ClustImpute is 0.5333333

## 40% missing

### partial km
```{r}
IBS40 <- as.data.frame(lapply(IBS, function(cc) cc[ sample(c(TRUE, NA), prob = c(0.6, 0.4), size = length(cc), replace = TRUE) ]))
set.seed(34)
Train_IBS40 <- IBS40[ trainIndex,]
Valid_IBS40 <- IBS40[-trainIndex,]
initC <- apply(Train_IBS40,2, function(x){x[sample(complete.cases(x) %>% which(),2)]})
initc <- as.data.frame(initC)[,1:42] %>% unlist() %>%as.numeric()

partial_model40 <- Partial_km(Train_IBS40[,-43],2,initc,10)
#manually change cluster sets
IBS40_fitted <- factor(partial_model40$fitted_value,labels = c(2,1))
test_accuracy(Train_IBS[,43],IBS40_fitted)
```

### ClustImpute

```{r}
imput_model40 <- ClustImpute(Train_IBS40[,-43],nr_cluster=2)
#imput_fitted <- factor(imput_model$clusters,labels = c(0,1))
#manually change cluster sets
IBS40_clusters <- factor(imput_model40$clusters,labels = c(2,1))
test_accuracy(Train_IBS[,43],IBS40_clusters)
```

# test 
```{r}
partial_test40 <- fitted.test(Valid_IBS40[,-43],2,partial_model40$fitted_Centroid)
test_cluster40 <- factor(partial_test40$fitted_values,labels = c(2,1))
#test with complete cases
test_accuracy(Valid_IBS[,43],test_cluster40)
# test with 40% missing data
test_accuracy(Valid_IBS40[,43],test_cluster40)
```
test accuracy of partial_km is 0.5666667

```{r}
impute_test40 <- fitted.test(Valid_IBS40[,-43],2,imput_model40$centroids[,-43])
impute_cluster40 <- factor(impute_test40$fitted_values,labels = c(2,1))
test_accuracy(Valid_IBS40[,43],impute_cluster40)
test_accuracy(Valid_IBS[,43],impute_cluster40)
```
test_accuracy of ClustImpute is 0.55

## 50% missing

### partial km
```{r}
IBS50 <- as.data.frame(lapply(IBS, function(cc) cc[ sample(c(TRUE, NA), prob = c(0.5, 0.5), size = length(cc), replace = TRUE) ]))
set.seed(34)
Train_IBS50 <- IBS50[ trainIndex,]
Valid_IBS50 <- IBS50[-trainIndex,]
initC <- apply(Train_IBS50,2, function(x){x[sample(complete.cases(x) %>% which(),2)]})
initc <- as.data.frame(initC)[,1:42] %>% unlist() %>%as.numeric()

partial_model50 <- Partial_km(Train_IBS50[,-43],2,initc,10)
#manually change cluster sets
IBS50_fitted <- factor(partial_model50$fitted_value,labels = c(2,1))
test_accuracy(Train_IBS50[,43],IBS50_fitted)
```

### ClustImpute

```{r}
imput_model50 <- ClustImpute(Train_IBS50[,-43],nr_cluster=2)
#imput_fitted <- factor(imput_model$clusters,labels = c(0,1))
#manually change cluster sets
IBS50_clusters <- factor(imput_model50$clusters,labels = c(2,1))
test_accuracy(Train_IBS50[,43],IBS50_clusters)
```

# test 
```{r}
partial_test50 <- fitted.test(Valid_IBS50[,-43],2,partial_model50$fitted_Centroid)
test_cluster50 <- factor(partial_test50$fitted_values,labels = c(2,1))
#test with complete cases
test_accuracy(Valid_IBS[,43],test_cluster50)
# test with 40% missing data
test_accuracy(Valid_IBS50[,43],test_cluster50)
```
test accuracy of partial_km is 0.4

```{r}
impute_test50 <- fitted.test(Valid_IBS50[,-43],2,imput_model50$centroids[,-43])
impute_cluster50 <- factor(impute_test50$fitted_values,labels = c(2,1))
test_accuracy(Valid_IBS[,43],impute_cluster50)
test_accuracy(Valid_IBS50[,43],impute_cluster50)
```
test_accuracy of ClustImpute is 0.2583333

